<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="D&D 5e Character Sheet intended to be easy to use to create characters and look up stats and take notes during play.">
    <title>5e Character Sheet PWA</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#fdf6e3">
    <!-- Design by Eric Schulte, source at https://github.com/eschulte/character-sheet -->
    <style>
        :root {
            --bg-color: #fdf6e3;
            --text-color: #2b2b2b;
            --border-color: #5c4b3f;
            --faint-line: #dcd6c7;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background-color: #222;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            display: flex;
            justify-content: center;
        }

        /* --- UI Controls --- */
        #app-controls {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: #333;
            color: white;
            padding: 10px;
            display: flex;
            gap: 10px;
            z-index: 1000;
            font-family: sans-serif;
            align-items: center;
        }
        
        button {
            padding: 5px 10px;
            cursor: pointer;
            background: #555;
            color: white;
            border: 1px solid #777;
        }

        /* --- Print Styles --- */
        @media print {
            #app-controls { display: none !important; }
            body { background: white; padding: 0; display: block; }
            .sheet-container { width: 100%; max-width: 100%; box-shadow: none; padding: 0; margin: 0; }
            textarea { border: 1px solid #ccc; }
        }

        /* --- Sheet Layout --- */
        .sheet-container {
            background-color: var(--bg-color);
            width: 100%;
            max-width: 950px;
            padding: 40px;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 40px;
        }

        input[type="text"], input[type="number"], textarea {
            background: transparent;
            border: none;
            border-bottom: 1px solid var(--border-color);
            width: 100%;
            font-family: inherit;
            font-size: 1rem;
            color: var(--text-color);
        }
        
        textarea { resize: vertical; border: 1px solid var(--faint-line); padding: 5px; }
        .label-sm { font-size: 0.7rem; text-transform: uppercase; color: #666; font-family: sans-serif; display: block; margin-top: 2px;}

        /* --- Header --- */
        .main-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 20px;
        }
        .header-section { display: flex; flex-direction: column; justify-content: flex-end; }

        /* --- Main Grid --- */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2.6fr; 
            gap: 25px;
        }

        .stats-col { display: flex; flex-direction: column; gap: 15px; }

        .ability-box {
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 10px 5px;
            text-align: center;
            background: rgba(255,255,255,0.3);
        }

        .ability-score { font-size: 1.5rem; font-weight: bold; width: 50px; margin: 0 auto; display: block; text-align: center; border: 1px solid #ccc; border-radius: 5px; }
        .ability-mod { font-size: 2rem; font-weight: bold; border: none; text-align: center;}
        
        .skills-list {
            font-size: 0.85rem;
            text-align: left;
            margin-top: 15px;
            padding-left: 5px;
        }
        
        .skill-row { 
            display: flex; align-items: center; gap: 5px; margin-bottom: 5px; border-bottom: 1px solid #eee;
        }
        
        .prof-bubble { 
            width: 12px; height: 12px; border: 1px solid black; border-radius: 50%; 
            appearance: none; cursor: pointer; flex-shrink: 0;
        }
        .prof-bubble:checked { background: black; }
        
        .save-val-input {
            width: 25px !important; text-align: center; font-size: 0.8rem; margin-right: 5px; border-bottom: 1px solid #999 !important;
        }

        /* Combat Area */
        .combat-row-1 {
            display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px;
        }
        .combat-row-2 {
            display: grid; grid-template-columns: 2fr 1fr; gap: 10px; margin-bottom: 20px;
        }

        .shield-box {
            border: 2px double var(--border-color);
            padding: 5px; text-align: center;
            border-radius: 5px 5px 50% 50%;
            display: flex; flex-direction: column; justify-content: center;
        }
        
        .rect-box {
            border: 2px double var(--border-color);
            padding: 5px; border-radius: 5px;
            display: flex; flex-direction: column;
        }

        .box-title { font-family: sans-serif; font-weight: bold; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; text-align: center; margin-bottom: 5px;}

        /* Death Saves */
        .death-save-row { display: flex; align-items: center; justify-content: space-between; font-size: 0.8rem; margin-top: 5px; }
        .ds-bubbles { display: flex; gap: 5px; }

        /* Tables */
        .weapons-table, .spells-list-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        .weapons-table th, .spells-list-table th { text-align: left; border-bottom: 2px solid var(--border-color); font-size: 0.8rem; }
        .weapons-table td, .spells-list-table td { border-bottom: 1px solid var(--faint-line); padding: 5px 0; }

        /* Bottom Sections */
        .bottom-sections {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;
        }
        .tall-box { height: 200px; display: flex; flex-direction: column;}
        .panel { border: 2px solid var(--border-color); border-radius: 5px; padding: 10px; }

        /* Proficiencies Box */
        .prof-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem; margin-bottom: 10px; }
        .prof-check-row { display: flex; gap: 10px; align-items: center; }

        /* Spell Page */
        .spell-grid-layout {
            display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; margin-top: 20px;
            border-top: 3px double var(--border-color); padding-top: 20px;
        }

        .spell-header {
            display: grid; grid-template-columns: 1.5fr 3.5fr; gap: 15px;
            border-bottom: 2px solid var(--border-color); padding-bottom: 10px; margin-bottom: 20px;
        }

        /* Spell Stats 2x2 Grid */
        .spell-stats-box {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
        }
        .spell-stat-item {
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 5px;
            text-align: center;
        }

        .spell-slots-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 10px 5px; 
            font-size: 0.8rem;
            white-space: nowrap;
        }
        
        .diamond-check {
            appearance: none; width: 12px; height: 12px; border: 1px solid black; transform: rotate(45deg);
            margin: 2px 3px; cursor: pointer; display: inline-block; vertical-align: middle;
        }
        .diamond-check:checked { background: black; }

        /* Bio Column */
        .bio-col { display: flex; flex-direction: column; gap: 15px; height: 100%; }
        
        .coins-container {
            border: 2px solid var(--border-color); padding: 5px; border-radius: 10px;
            display: flex; flex-direction: column;
        }
        .coins { display: flex; gap: 5px; justify-content: space-around; }
        .coin-slot input { width: 40px; text-align: center; }

        @media screen and (max-width: 768px) {
            .main-grid, .spell-grid-layout, .main-header, .combat-row-1, .combat-row-2, .spell-header, .bottom-sections, .prof-grid { display: flex; flex-direction: column; }
            #app-controls { position: relative; }
            body { padding: 0; }
            .sheet-container { margin-top: 0; padding: 10px; }
        }
    </style>
</head>
<body>

    <div id="app-controls">
        <span><b>D&D 5e PWA</b></span>
        <button onclick="saveVersion()">Save Snapshot</button>
        <select id="versionSelect" onchange="loadSelectedVersion()">
            <option value="">Load Version...</option>
        </select>
        <button onclick="resetSheet()" style="background: #800;">Reset</button>
        <button onclick="window.print()" style="background: #005f80;">Print</button>
        <span id="status" style="font-size: 0.8rem; color: #aaa; margin-left: auto;">Auto-saving...</span>
    </div>

    <div class="sheet-container">
        
        <div class="main-header">
            <div class="header-section">
                <input type="text" id="charName" placeholder="Character Name" style="font-size: 1.5rem; font-weight: bold;">
                <span class="label-sm">Character Name</span>
                <input type="text" id="species" placeholder="Species" style="margin-top: 5px;">
                <span class="label-sm">Species</span>
            </div>
            <div class="header-section">
                <input type="text" id="class">
                <span class="label-sm">Class</span>
                <input type="text" id="subclass">
                <span class="label-sm">Subclass</span>
            </div>
            <div class="header-section">
                <input type="text" id="level">
                <span class="label-sm">Level</span>
                <input type="text" id="xp">
                <span class="label-sm">XP</span>
            </div>
            <div class="header-section">
                <div class="shield-box">
                    <span class="box-title">Armor Class</span>
                    <input type="number" id="ac" style="font-size: 1.5rem; text-align: center; border: none;">
                </div>
            </div>
        </div>

        <div class="main-grid">
            <div class="stats-col">
                <div class="ability-box">
                    <span class="box-title">Prof. Bonus</span>
                    <input type="text" id="prof-bonus" style="font-size: 1.5rem; text-align: center; border:none;">
                </div>

                <script>
                    const abilityData = {
                        "Strength": ["Athletics"],
                        "Dexterity": ["Acrobatics", "Sleight of Hand", "Stealth"],
                        "Constitution": [], 
                        "Intelligence": ["Arcana", "History", "Investigation", "Nature", "Religion"],
                        "Wisdom": ["Animal Handling", "Insight", "Medicine", "Perception", "Survival"],
                        "Charisma": ["Deception", "Intimidation", "Performance", "Persuasion"]
                    };

                    for (const [stat, skills] of Object.entries(abilityData)) {
                        const lowStat = stat.toLowerCase();
                        let skillsHtml = '';
                        skills.forEach(skill => {
                            const skillId = skill.replace(/\s+/g, '-').toLowerCase();
                            skillsHtml += `
                            <div class="skill-row">
                                <input type="number" class="save-val-input" id="val-${lowStat}-${skillId}" placeholder="0">
                                <input type="checkbox" class="prof-bubble" id="prof-${lowStat}-${skillId}"> 
                                <span>${skill}</span>
                            </div>`;
                        });
                        document.write(`
                        <div class="ability-box">
                            <span class="box-title">${stat}</span>
                            <div style="position: relative;">
                                <input type="number" id="${lowStat}-mod" class="ability-mod" placeholder="+0">
                                <span class="label-sm">Modifier</span>
                                <input type="number" id="${lowStat}-score" class="ability-score" placeholder="10">
                                <span class="label-sm">Score</span>
                            </div>
                            <div class="skills-list">
                                <div class="skill-row" style="font-weight: bold; border-bottom: 2px solid #ccc;">
                                    <input type="number" class="save-val-input" id="save-val-${lowStat}" placeholder="0">
                                    <input type="checkbox" class="prof-bubble" id="save-prof-${lowStat}"> 
                                    <span>Saving Throw</span>
                                </div>
                                ${skillsHtml}
                            </div>
                        </div>
                        `);
                    }
                </script>
            </div>

            <div class="main-col">
                <div class="combat-row-1">
                    <div class="shield-box">
                        <span class="box-title">Initiative</span>
                        <input type="text" id="initiative" style="text-align: center; font-size: 1.5rem;">
                    </div>
                    <div class="shield-box">
                        <span class="box-title">Speed</span>
                        <input type="text" id="speed" style="text-align: center; font-size: 1.5rem;">
                    </div>
                    <div class="shield-box">
                        <span class="box-title">Size</span>
                        <input type="text" id="size" style="text-align: center; font-size: 1.5rem;">
                    </div>
                    <div class="shield-box">
                        <span class="box-title">Passive Perc.</span>
                        <input type="text" id="pass-perc" style="text-align: center; font-size: 1.5rem;">
                    </div>
                </div>

                <div class="combat-row-2">
                    <div class="rect-box">
                        <span class="box-title">Hit Points</span>
                        <div style="display: flex; gap: 10px; height: 100%;">
                            <div style="flex:1; text-align: center;">
                                <input type="number" id="hp-max" placeholder="Max" style="text-align:center;">
                                <span class="label-sm">Max</span>
                            </div>
                            <div style="flex:1; text-align: center;">
                                <input type="number" id="hp-curr" placeholder="Current" style="text-align:center; font-size: 1.2rem; font-weight: bold;">
                                <span class="label-sm">Current</span>
                            </div>
                            <div style="flex:1; text-align: center;">
                                <input type="number" id="hp-temp" placeholder="Temp" style="text-align:center;">
                                <span class="label-sm">Temp</span>
                            </div>
                        </div>
                    </div>

                    <div class="rect-box">
                        <span class="box-title">Death Saves</span>
                        <div class="death-save-row">
                            <span>Successes</span>
                            <div class="ds-bubbles">
                                <input type="checkbox" class="prof-bubble" id="ds-s-1"><input type="checkbox" class="prof-bubble" id="ds-s-2"><input type="checkbox" class="prof-bubble" id="ds-s-3">
                            </div>
                        </div>
                        <div class="death-save-row">
                            <span>Failures</span>
                            <div class="ds-bubbles">
                                <input type="checkbox" class="prof-bubble" id="ds-f-1"><input type="checkbox" class="prof-bubble" id="ds-f-2"><input type="checkbox" class="prof-bubble" id="ds-f-3">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <span class="box-title">Weapons & Damage Cantrips</span>
                    <table class="weapons-table">
                        <thead><tr><th>Name</th><th>Atk/DC</th><th>Damage</th><th>Notes</th></tr></thead>
                        <tbody id="weapons-body"></tbody>
                    </table>
                    <button onclick="addWeaponRow()" style="width: 100%;">+</button>
                </div>

                <br>
                <div class="panel" style="min-height: 200px;">
                    <span class="box-title">Class Features</span>
                    <textarea id="class-features" style="height: 100%; border:none;"></textarea>
                </div>

                <div class="bottom-sections">
                    <div class="panel tall-box">
                        <span class="box-title">Species Traits</span>
                        <textarea id="species-traits" style="height: 100%; border:none;"></textarea>
                    </div>
                    <div class="panel tall-box">
                        <span class="box-title">Feats</span>
                        <textarea id="feats" style="height: 100%; border:none;"></textarea>
                    </div>
                </div>
                
                <div class="panel" style="margin-top: 10px;">
                    <span class="box-title">Proficiencies & Training</span>
                    <div style="margin-bottom: 5px; border-bottom: 1px solid #ddd; padding-bottom: 5px;">
                        <span class="label-sm" style="display:inline; margin-right: 10px;">Armor:</span>
                        <label><input type="checkbox" id="prof-armor-light"> Light</label> &nbsp;
                        <label><input type="checkbox" id="prof-armor-medium"> Medium</label> &nbsp;
                        <label><input type="checkbox" id="prof-armor-heavy"> Heavy</label> &nbsp; | &nbsp;
                        <label><input type="checkbox" id="prof-shields"> Shields</label>
                    </div>
                    <div class="prof-grid">
                        <div>
                            <span class="label-sm">Weapons</span>
                            <textarea id="prof-weapons-text" style="height: 60px;"></textarea>
                        </div>
                        <div>
                            <span class="label-sm">Tools</span>
                            <textarea id="prof-tools-text" style="height: 60px;"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="spell-grid-layout">
            <div>
                <div class="spell-header">
                    <div class="panel">
                        <span class="box-title" style="margin-bottom: 10px; display:block;">Spellcasting</span>
                        <div class="spell-stats-box">
                            <div class="spell-stat-item">
                                <span class="label-sm">Ability</span>
                                <input type="text" id="spell-ability" style="text-align:center;">
                            </div>
                            <div class="spell-stat-item">
                                <span class="label-sm">Modifier</span>
                                <input type="text" id="spell-mod" style="text-align:center;">
                            </div>
                            <div class="spell-stat-item">
                                <span class="label-sm">Save DC</span>
                                <input type="text" id="spell-save-dc" style="text-align:center;">
                            </div>
                            <div class="spell-stat-item">
                                <span class="label-sm">Atk Bonus</span>
                                <input type="text" id="spell-atk" style="text-align:center;">
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel">
                        <span class="box-title">Spell Slots</span>
                        <div class="spell-slots-grid">
                            <script>
                                const slotCounts = [0, 4, 3, 3, 3, 3, 2, 2, 1, 1];
                                for(let i=1; i<=9; i++) {
                                    document.write(`<div>${i}${i===1?'st':i===2?'nd':i===3?'rd':'th'} `);
                                    let count = slotCounts[i];
                                    for(let j=0; j<count; j++) {
                                        document.write(`<input type="checkbox" class="diamond-check" id="slot-${i}-${j}">`);
                                    }
                                    document.write(`</div>`);
                                }
                            </script>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <span class="box-title">Cantrips & Prepared Spells</span>
                    <table class="spells-list-table">
                        <thead><tr><th width="30">Lvl</th><th>Name</th><th width="80" style="text-align: center;">C / R / M</th></tr></thead>
                        <tbody id="spells-body"></tbody>
                    </table>
                    <button onclick="addSpellRow()" style="width: 100%;">+</button>
                </div>
            </div>

            <div class="bio-col">
                <div class="panel">
                    <span class="box-title">Appearance</span>
                    <textarea id="appearance" style="height: 80px; border:none;"></textarea>
                </div>
                
                <div class="panel" style="height: 250px; display: flex; flex-direction: column;">
                    <span class="box-title">Backstory & Personality</span>
                    <textarea id="backstory" style="flex-grow: 1; border:none;"></textarea>
                    <div style="margin-top: 5px; border-top: 1px solid #ccc; padding-top: 5px;">
                        <span class="label-sm" style="display:inline;">Alignment:</span>
                        <input type="text" id="alignment" style="width: 70%; display:inline-block;">
                    </div>
                </div>

                <div class="panel">
                    <span class="box-title">Languages</span>
                    <textarea id="languages" style="height: 50px; border:none;"></textarea>
                </div>

                <div class="panel" style="flex-grow: 1; min-height: 300px;">
                    <span class="box-title">Equipment</span>
                    <textarea id="equipment" style="height: 100%; border:none;"></textarea>
                </div>
                
                <div class="coins-container">
                    <span class="box-title">COINS</span>
                    <div class="coins">
                        <div class="coin-slot"><span class="label-sm">CP</span><input type="number" id="cp"></div>
                        <div class="coin-slot"><span class="label-sm">SP</span><input type="number" id="sp"></div>
                        <div class="coin-slot"><span class="label-sm">EP</span><input type="number" id="ep"></div>
                        <div class="coin-slot"><span class="label-sm">GP</span><input type="number" id="gp"></div>
                        <div class="coin-slot"><span class="label-sm">PP</span><input type="number" id="pp"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            for(let i=0; i<5; i++) addWeaponRow();
            for(let i=0; i<15; i++) addSpellRow();
            
            const allInputs = document.querySelectorAll('input, textarea');
            allInputs.forEach(input => {
                input.addEventListener('input', debounce(autoSave, 1000));
                input.addEventListener('change', autoSave);
            });

            loadData();
            updateVersionDropdown();
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').catch(err => console.log('SW fail', err));
            }
        });

        function addWeaponRow() {
            const tbody = document.getElementById('weapons-body');
            const tr = document.createElement('tr');
            tr.innerHTML = `<td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td>`;
            tbody.appendChild(tr);
            tr.querySelectorAll('input').forEach(i => i.addEventListener('input', debounce(autoSave, 1000)));
        }

        function addSpellRow() {
            const tbody = document.getElementById('spells-body');
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><input type="text" style="width:25px; text-align:center;"></td>
                <td><input type="text"></td>
                <td style="white-space: nowrap; text-align: center;">
                    <input type="checkbox" class="diamond-check" title="Concentration">
                    <input type="checkbox" class="diamond-check" title="Ritual">
                    <input type="checkbox" class="diamond-check" title="Material">
                </td>`;
            tbody.appendChild(tr);
            tr.querySelectorAll('input').forEach(i => i.addEventListener('input', debounce(autoSave, 1000)));
        }

        function collectData() {
            const data = {};
            document.querySelectorAll('input[id], textarea[id]').forEach(el => {
                data[el.id] = (el.type === 'checkbox') ? el.checked : el.value;
            });

            data['weapons'] = [];
            document.querySelectorAll('#weapons-body tr').forEach(tr => {
                const i = tr.querySelectorAll('input');
                data['weapons'].push([i[0].value, i[1].value, i[2].value, i[3].value]);
            });

            data['spells'] = [];
            document.querySelectorAll('#spells-body tr').forEach(tr => {
                const i = tr.querySelectorAll('input');
                data['spells'].push([i[0].value, i[1].value, i[2].checked, i[3].checked, i[4].checked]);
            });
            
            data['spellSlots'] = {};
            document.querySelectorAll('.spell-slots-grid input[type="checkbox"]').forEach(cb => {
                data['spellSlots'][cb.id] = cb.checked;
            });
            
            return data;
        }

        function populateData(data) {
            if(!data) return;
            for (const [key, value] of Object.entries(data)) {
                if(key === 'spellSlots') continue;
                const el = document.getElementById(key);
                if (el) {
                    if(el.type === 'checkbox') el.checked = value;
                    else el.value = value;
                }
            }
            if(data.weapons) {
                const rows = document.querySelectorAll('#weapons-body tr');
                data.weapons.forEach((r, i) => { if(rows[i]) { let inputs = rows[i].querySelectorAll('input'); inputs[0].value=r[0]; inputs[1].value=r[1]; inputs[2].value=r[2]; inputs[3].value=r[3]; }});
            }
            if(data.spells) {
                const rows = document.querySelectorAll('#spells-body tr');
                data.spells.forEach((r, i) => { if(rows[i]) { let inputs = rows[i].querySelectorAll('input'); inputs[0].value=r[0]; inputs[1].value=r[1]; inputs[2].checked=r[2]; inputs[3].checked=r[3]; inputs[4].checked=r[4]; }});
            }
            if(data.spellSlots) {
                for (const [slotId, checked] of Object.entries(data.spellSlots)) {
                    const el = document.getElementById(slotId);
                    if(el) el.checked = checked;
                }
            }
        }

        function autoSave() {
            localStorage.setItem('dnd_current_sheet', JSON.stringify(collectData()));
            document.getElementById('status').innerText = 'Saved ' + new Date().toLocaleTimeString();
        }

        function saveVersion() {
            const name = prompt("Version Name:");
            if(!name) return;
            let versions = JSON.parse(localStorage.getItem('dnd_versions') || "[]");
            versions.push({ name: name, timestamp: new Date().toISOString(), data: collectData() });
            localStorage.setItem('dnd_versions', JSON.stringify(versions));
            updateVersionDropdown();
        }

        function loadData() {
            const stored = localStorage.getItem('dnd_current_sheet');
            if(stored) populateData(JSON.parse(stored));
        }

        function updateVersionDropdown() {
            const select = document.getElementById('versionSelect');
            select.innerHTML = '<option value="">Load Version...</option>';
            const versions = JSON.parse(localStorage.getItem('dnd_versions') || "[]");
            versions.forEach((v, idx) => {
                const opt = document.createElement('option');
                opt.value = idx;
                opt.text = `${v.name} (${new Date(v.timestamp).toLocaleDateString()})`;
                select.appendChild(opt);
            });
        }

        function loadSelectedVersion() {
            const idx = document.getElementById('versionSelect').value;
            if(idx === "") return;
            if(confirm("Overwrite current data?")) {
                populateData(JSON.parse(localStorage.getItem('dnd_versions'))[idx].data);
                autoSave();
            }
        }

        function resetSheet() {
            if(confirm("Clear all?")) {
                document.querySelectorAll('input').forEach(i => { if(i.type==='checkbox')i.checked=false; else i.value=""; });
                document.querySelectorAll('textarea').forEach(t=>t.value="");
                autoSave();
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function(...args) { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), wait); };
        }
    </script>
</body>
</html>
